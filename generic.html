---
layout: page
title: Docs
---
<section>
	<h3>Folder Structure</h3>
	<h4>mobile 폴더를 기준으로 설명한다.</h4>
	<div class="table-wrapper">
		<table>
			<thead>
				<tr>
					<th>Name</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>client</td>
					<td>클라이언트에서만 실행되는 코드. HTML, CSS로 이루어져 있는 프론트엔드 폴더</td>
				</tr>
				<tr>
					<td>server</td>
					<td>서버에서만 실행되는 코드. SUJI가 구동될 때 자동으로 data를 넣는 코드와 MongoDB의 Collection을 동기화한다</td>
				</tr>
				<tr>
					<td>collections</td>
					<td>MongoDB의 Collection이 정의된 폴더</td>
				</tr>
				<tr>
					<td>public</td>
					<td>Logo 이미지 등 staic resource가 있는 폴더</td>
				</tr>
			</tbody>
		</table>
		</div>
</section>
<hr />

<h4>client 폴더</h4>
클라이언트 폴더는 routes.js, index.html 그리고 각각의 모듈들이 정의되어 있는 폴더(bell, category ...)가 있다.<br>
각 모듈들의 폴더의 구조는 아래와 같다.
	<div class="table-wrapper">
		<table>
			<thead>
				<tr>
					<th>Name</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>config</td>
					<td>각 폴더의 route 설정을 위한 파일이 위치한다.</td>
				</tr>
				<tr>
					<td>controller</td>
					<td>콜백 메소드와 scope를 가지고 views 폴더로 퍼블리싱을 담당한다.</td>
				</tr>
				<tr>
					<td>styles</td>
					<td>스타일시트가 들어있다.</td>
				</tr>
				<tr>
					<td>views</td>
					<td>ng-view에 뿌려줄 html template 파일들이 위치한다.</td>
				</tr>
			</tbody>
		</table>
		</div>
</ul>

예를들어 category.config.js 파일에 다음과 같이 정의되어 있다. 이는 category 모듈에 대한 view, controller를 정의한다. 기타 코드 구조에 대한 설명은 AngularJS를 참고한다.
<pre><code>
angular.module('suji').config(['$stateProvider',
  function($stateProvider) {

    $stateProvider
      .state('category', {
        parent: 'root',
        url: '/category',
        templateUrl: 'client/category/views/category.ng.html',
        controller: 'categoryCtrl'
      });
  }
]);
</code></pre>
<hr />

<h4>Server 폴더</h4>
Server 폴더 내 소스들은 대부분 client와 데이터를 동기화하기 위한 publish 기능을 하는 파일들로 이루어져 있다.
server/startup에 있는 소스는 아래 코드처럼 SUJI가 실행될 때 테스트 데이터를 넣는 작업을 한다.
<pre><code>
// server/startup/load-category.js

Meteor.startup(function() {
  if (Category.find().count() === 0) {
    var categories = [{
      'categoryName': 'FOOD'
    }, {
      'categoryName': 'DRINK'
    }, {
      'categoryName': 'NECESSARIES'
    }, {
      'categoryName': 'OFFICE'
    }];

    for (var i = 0; i < categories.length; i++) {
      Category.insert({
        categoryName: categories[i].categoryName,
        createdAt: new Date()
      });
    }
  }
});
</code></pre>
<hr />


<h3>
	Data Transfer
</h3>
SUJI는 Meteor 플랫폼을 기반으로하기 때문에 Publish, Subscribe 방식을 통해 데이터를 주고 받는다. 코드는 다음과 같다.

<pre><code>
// client/category/controllers/category.controller.js 
 $meteor.autorun($scope, function() {
            $meteor.subscribe('category', {}, $scope.getReactively('search')).then(function() {
                console.log('Got category');
            });
        });
        
// sever/category.js
Meteor.publish("category", function(options, searchString) {
  if (!searchString) {
    searchString = '';
  }
  var searchFor = {
    '$regex': '.*' + (searchString || '') + '.*',
    '$options': 'i'
  };

  return Category.find({
      $or: [{
        categoryName: searchFor
      }]
    },
    options);
});

</code></pre>
SUJI는 모든 모듈에서 위의 코드처럼 서버의 publish, 클라이언트의 subscribe를 통해 데이터를 동기화 한다. 내부 로직에 대한 이해는 Meteor를 이해해야 한다. <a href="https://www.discovermeteor.com">Meteor 강의 사이트</a>를 참고한다.

<hr />
<h4>Collections</h4>
SUJI에서 쓰이는 MongoDB의 Collection은 다음과 같다.
	<div class="table-wrapper">
		<table>
			<thead>
				<tr>
					<th>Name</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>bell</td>
				</tr>
				<tr>
					<td>category</td>
				</tr>
				<tr>
					<td>employee</td>
				</tr>
				<tr>
					<td>menu</td>
				</tr>
				<tr>
					<td>purchase</td>
				</tr>
				<tr>
					<td>serial</td>
				</tr>
				<tr>
					<td>store</td>
				</tr>
			</tbody>
		</table>
		</div>
<hr />



